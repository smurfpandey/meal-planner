<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meal Planner App</title>
  <style>
    [x-cloak] {
      display: none !important;
    }
  </style>
</head>

<body class="min-h-screen bg-gray-50" x-data="mealPlanner()" x-cloak>
  <div id="app" class="max-w-6xl mx-auto p-4">
    <!-- Header -->
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">Meal Planner</h1>
      <p class="text-gray-600">Plan your weekly meals and stay organized</p>
    </header>

    <!-- Navigation -->
    <div class="w-full mb-6">
      <div class="grid grid-cols-4 bg-gray-100 rounded-lg p-1">
        <button @click="activeTab = 'home'" :class="activeTab === 'home' ? 'bg-white shadow-sm' : ''"
          class="flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors">
          <i data-lucide="home" class="w-4 h-4"></i>

          Home
        </button>
        <button @click="activeTab = 'meals'" :class="activeTab === 'meals' ? 'bg-white shadow-sm' : ''"
          class="flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors">
          <i data-lucide="utensils" class="w-4 h-4"></i>
          Meals
        </button>
        <button @click="activeTab = 'add-meal'" :class="activeTab === 'add-meal' ? 'bg-white shadow-sm' : ''"
          class="flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors">
          <i data-lucide="plus" class="w-4 h-4"></i>
          Add Meal
        </button>
        <button @click="activeTab = 'create-plan'" :class="activeTab === 'create-plan' ? 'bg-white shadow-sm' : ''"
          class="flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors">
          <i data-lucide="calendar" class="w-4 h-4"></i>
          Create Plan
        </button>
      </div>
    </div>

    <!-- Tab Content -->
    <!-- Home Tab -->
    <div x-show="activeTab === 'home'" class="bg-white rounded-lg shadow-sm border">
      <div class="p-6 border-b">
        <h2 class="text-xl font-semibold">Weekly Meal Plan</h2>
      </div>
      <div class="p-6">
        <div x-show="isPlanEmpty()" class="text-center py-12">
          <i data-lucide="calendar" class="w-16 h-16 mx-auto text-gray-400 mb-4"></i>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No meal plan created yet</h3>
          <p class="text-gray-600 mb-4">Create your first weekly meal plan to get started</p>
          <button @click="activeTab = 'create-plan'"
            class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
            Create Plan
          </button>
        </div>

        <div x-show="!isPlanEmpty()" class="space-y-4">
          <template x-for="(day, index) in days" :key="day">
            <div class="border rounded-lg p-4">
              <h3 class="font-semibold text-lg mb-3 capitalize" x-text="dayLabels[index]"></h3>
              <div class="grid md:grid-cols-3 gap-4">
                Breakfast
                <div>
                  <h4 class="font-medium text-sm text-gray-600 mb-2">Breakfast</h4>
                  <div x-show="weeklyPlan[day].breakfast" class="bg-orange-50 border border-orange-200 rounded p-2">
                    <p class="font-medium" x-text="weeklyPlan[day].breakfast?.name"></p>
                    <span class="inline-block bg-gray-200 text-gray-800 text-xs px-2 py-1 rounded mt-1"
                      x-text="weeklyPlan[day].breakfast?.type"></span>
                  </div>
                  <div x-show="!weeklyPlan[day].breakfast"
                    class="bg-gray-50 border-2 border-dashed border-gray-200 rounded p-2 text-center text-gray-500 text-sm">
                    No meal planned
                  </div>
                </div>
                Lunch
                <div>
                  <h4 class="font-medium text-sm text-gray-600 mb-2">Lunch</h4>
                  <div x-show="weeklyPlan[day].lunch" class="bg-green-50 border border-green-200 rounded p-2">
                    <p class="font-medium" x-text="weeklyPlan[day].lunch?.name"></p>
                    <span class="inline-block bg-gray-200 text-gray-800 text-xs px-2 py-1 rounded mt-1"
                      x-text="weeklyPlan[day].lunch?.type"></span>
                  </div>
                  <div x-show="!weeklyPlan[day].lunch"
                    class="bg-gray-50 border-2 border-dashed border-gray-200 rounded p-2 text-center text-gray-500 text-sm">
                    No meal planned
                  </div>
                </div>
                Dinner
                <div>
                  <h4 class="font-medium text-sm text-gray-600 mb-2">Dinner</h4>
                  <div x-show="weeklyPlan[day].dinner" class="bg-blue-50 border border-blue-200 rounded p-2">
                    <p class="font-medium" x-text="weeklyPlan[day].dinner?.name"></p>
                    <span class="inline-block bg-gray-200 text-gray-800 text-xs px-2 py-1 rounded mt-1"
                      x-text="weeklyPlan[day].dinner?.type"></span>
                  </div>
                  <div x-show="!weeklyPlan[day].dinner"
                    class="bg-gray-50 border-2 border-dashed border-gray-200 rounded p-2 text-center text-gray-500 text-sm">
                    No meal planned
                  </div>
                </div>
              </div>
            </div>
          </template>
        </div>
      </div>
    </div>
    <!-- Meals Tab -->
    <div x-show="activeTab === 'meals'" class="bg-white rounded-lg shadow-sm border">
      <div class="p-6 border-b flex justify-between items-center">
        <h2 class="text-xl font-semibold">All Meals (<span x-text="meals.length"></span>)</h2>
        <button @click="loadMeals()" :disabled="isLoadingMeals"
          class="flex items-center gap-2 px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50">
          <i data-lucide="refresh-cw" class="w-4 h-4" :class="{'animate-spin': isLoadingMeals}"></i>
          Refresh
        </button>
      </div>
      <div class="p-6">
        <div x-show="isLoadingMeals" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
          <template x-for="i in 6" :key="i">
            <div class="border rounded-lg p-4">
              <div class="h-6 bg-gray-200 rounded animate-pulse mb-3"></div>
              <div class="h-4 bg-gray-200 rounded animate-pulse w-1/2 mb-2"></div>
              <div class="flex gap-2 mt-3">
                <div class="h-6 bg-gray-200 rounded animate-pulse w-16"></div>
                <div class="h-6 bg-gray-200 rounded animate-pulse w-20"></div>
              </div>
            </div>
          </template>
        </div>

        <div x-show="mealsError && !isLoadingMeals" class="text-center py-8">
          <i data-lucide="alert-circle" class="w-8 h-8 mx-auto text-red-500 mb-4"></i>
          <p class="text-red-600 mb-4" x-text="mealsError"></p>
          <button @click="loadMeals()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
            Try Again
          </button>
        </div>

        <div x-show="meals.length === 0 && !isLoadingMeals && !mealsError" class="text-center py-8">
          <i data-lucide="utensils" class="w-12 h-12 mx-auto text-gray-400 mb-4"></i>
          <p class="text-gray-600">No meals found</p>
        </div>

        <div x-show="meals.length > 0 && !isLoadingMeals && !mealsError"
          class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
          <template x-for="meal in meals" :key="meal.id">
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
              <h3 class="font-semibold mb-2" x-text="meal.name"></h3>
              <div class="flex flex-wrap gap-1 mt-2">
                <span class="inline-block border border-gray-300 text-gray-700 text-xs px-2 py-1 rounded"
                  x-text="meal.type"></span>
                <template x-for="mealTime in meal.mealTime" :key="mealTime">
                  <span class="inline-block text-xs px-2 py-1 rounded text-white" :class="{
                                            'bg-blue-600': mealTime === 'Breakfast',
                                            'bg-gray-600': mealTime === 'Lunch', 
                                            'bg-red-600': mealTime === 'Dinner'
                                        }" x-text="mealTime"></span>
                </template>
              </div>
            </div>
          </template>
        </div>
      </div>
    </div>

    <div x-show="activeTab === 'add-meal'" class="bg-white rounded-lg shadow-sm border">
      <div class="p-6 border-b">
        <h2 class="text-xl font-semibold">Add New Meal</h2>
      </div>
      <div class="p-6 space-y-4">
        <div>
          <label for="meal-name" class="block text-sm font-medium text-gray-700 mb-1">Meal Name</label>
          <input id="meal-name" type="text" x-model="newMeal.name" placeholder="e.g., Grilled Chicken Salad"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
          <label for="meal-type" class="block text-sm font-medium text-gray-700 mb-1">Meal Type</label>
          <input id="meal-type" type="text" x-model="newMeal.type" placeholder="e.g., Healthy, Quick, Italian"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Meal Times</label>
          <div class="grid grid-cols-3 gap-4">
            <template x-for="mealTime in ['Breakfast', 'Lunch', 'Dinner']" :key="mealTime">
              <div class="flex items-center space-x-2">
                <input type="checkbox" :id="mealTime" :value="mealTime" x-model="newMeal.mealTimes"
                  class="rounded border-gray-300">
                <label :for="mealTime" class="text-sm font-normal cursor-pointer" x-text="mealTime"></label>
              </div>
            </template>
          </div>
        </div>
        <button @click="addMeal()" :disabled="!newMeal.name || !newMeal.type || newMeal.mealTimes.length === 0"
          :class="(!newMeal.name || !newMeal.type || newMeal.mealTimes.length === 0) ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'"
          class="w-full text-white px-4 py-2 rounded-md transition-colors">
          Add Meal
        </button>
      </div>
    </div>

    <div x-show="activeTab === 'create-plan'" class="bg-white rounded-lg shadow-sm border">
      <div class="p-6 border-b">
        <h2 class="text-xl font-semibold">Create Weekly Plan</h2>
      </div>
      <div class="p-6">
        <div class="space-y-6">
          <template x-for="(day, index) in days" :key="day">
            <div class="border rounded-lg p-4">
              <h3 class="font-semibold text-lg mb-4 capitalize" x-text="dayLabels[index]"></h3>
              <div class="grid md:grid-cols-3 gap-4">
                <template x-for="mealSlot in ['breakfast', 'lunch', 'dinner']" :key="mealSlot">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2 capitalize" x-text="mealSlot"></label>
                    <select :value="weeklyPlan[day][mealSlot]?.id || ''"
                      @change="assignMealToPlan(day, mealSlot, $event.target.value)"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                      <option value="" x-text="`Select ${mealSlot}`"></option>
                      <option value="remove">Remove meal</option>
                      <template x-for="meal in getMealsByMealTime(mealSlot.charAt(0).toUpperCase() + mealSlot.slice(1))"
                        :key="meal.id">
                        <option :value="meal.id" x-text="`${meal.name} (${meal.type})`"></option>
                      </template>
                    </select>
                  </div>
                </template>
              </div>
            </div>
          </template>
        </div>
        <div class="mt-6 text-center">
          <button @click="activeTab = 'home'"
            class="bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 text-lg">
            View Plan
          </button>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="/src/main.js"></script>
</body>

</html>